# CHAT BY Dmitriev Sergey for WinDI_Tech_Spec

## Запуск приложения

1. `docker compose up -d` - сбилдить образ приложения, поднять его, поднять образ PSQL

2. Далее нужно накатить миграции и загрузки тестовых данных войдём в bash системы, поднятой в контейнере. Для этого `docker ps -a` и контейнер с названием `dmitriev_chat_api`. Скопируйте его CONTAINER ID. Далее введите команду `docker exec -it *вставить CONTAINER ID* bash`. Вы окажетесь в командной оболочке контейнера в рабочей директории `/code`. Введите `cd src/` и перейдите в основную директорию проекта.

2.2 Для накатки миграций введите `alembic upgrade head`. Если после этого вам для какой-то цели нужно будет откатить миграции обратно, то выполните `alembic downgrade -1` - на данный момент миграция только одна. 

2.3 Для загрузки в базу тестовых данных введите `python load_data.py`. База будет приведена в состояние, в котором существуют 3 пользователя: Sergey, Arina, Vlad. Пароль для каждой учётной записи одинаковый: 12345

3. Для синхронизации информации, которая хранится персистентно с информацией, хранимой оперативно, необходимо сделать запрос GET /chat/sync/persistent
Это может быть нужно после перезапуска приложения или после загрузки тестовых данных, и всякий раз, когда данные о чат-команатах по какой-либо причине могли быть утеряны из оперативной памяти

4. Для переопределения стандартных настроек необохидимо в корне проекта создать файл расширения .env с названием ландшафта (local, dev, test, prod) и выставить в контейнере переменную окружения DMITRIEV_CHAT_ENV с соотвестующим значением. По умолчанию - local

5. Для запуска тестов - `test-docker-compose up -d` && `pytest`


## Запросы

Все возможные REST запросы можно просмотреть в автоматически сгенерированной документации GET /docs

Для всех запросов, кроме POST /user, необходима авторизация

### Авторизация

POST /auth/login {"grant_type": "password", "username": "*Имя пользователя*", "password": "*Пароль*"}
В случае успешной авторизации браузер получит куку, в который будет помещён JWT токен, содержащий идентификационную информацию о пользователе. Время жизни токена можно настроить в конфиге

POST /auth/logout - удаляет вышеупомянутую куку

### Создание юзера 

POST /user {"name": str, "email": str, "password": str} - будет зарегистрирован юзер с переданными данными. Хеш пароля будет сохранён в БД, для защиты пароля от компрементации. Алгоритм хеширования можно настроить в конфиге


### Создание чата

POST /chat {"name": *название чата*, "chat_type": "PRIVATE"/"GROUP"}
В приложении будет создан чат, связанная с ним группа с соответствующим типом. Формально, все различия между групповым и личным чатами заключается в невозможности добавления во второй больше 2-х персон. Создателем чата будем пользователь, авторизованный при создании


### Добавление и удаление пользователей из чатов

Данные действия может производить только создатель чата. 

POST /chat/add_user/{id добавляемого пользователя}/{chat_id} пользователь получит доступ к возможности читать историю чата и писать в него

POST /chat/remove_user/{id добавляемого пользователя}/{chat_id}

### Синхронизация данных

GET /chat/sync/persistent - по хорошему эндпоинт должен быть доступен только админу, но в данной итерации разработки приложения ролевая система не инетгрирована. Так что пусть пока висит открытым


### История чата

GET /history/{chat_id}?limit=&offset=
Данное действие может совершать только пользователь, который является членом чата. С учётом переданных параметров будет получена история переписки чата


### Подключение к чату

GET /chat/{chat_id} 

Пользователь должен быть членом чата, для успешного подключения. После подключения пользователь окажется на простенькой вебстранице, представляющей собой интерфейс чата.

Так как проект направлен на демонстрацию навыков написания backend части приложения, интерфейс выглядит так как выглядит xD
